<!-- Script: Dhinakaran -->
<!-- GitHub: https://github.com/dinacran/ -->     

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>json</title>
    <style>
        body {
            font-family: monospace;
            margin: 0;
            padding: 0;
            background-color: black;
            color: #e0e0e0;
            overflow: hidden;
            zoom: 80%; 

        }
    
        input[type="text"],
        input[name="client"],
        button {
            font-family: monospace;
            font-size: 16px;
            margin-top: 10px;
            padding: 8px 12px;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1e1e1e;
            color: #e0e0e0;
            outline: none;
        }
        input[name="client"]{
            width: 235px;
        }
    
        input[type="text"]:focus,
        input[name="client"]:focus,
        button:focus {
            border-color: #1e88e5;
            box-shadow: 0 0 5px rgba(30, 136, 229, 0.5);
        }
    
        button {
            background-color: #1e88e5;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
    
        button:hover {
            background-color: #1565c0;
        }
   
        input[group="data"] {
            appearance: none; 
            position:absolute;
            opacity: 0;
        }

        input[group="data"]:checked + label {
            margin-left: 0px;
            margin-right: -8px;
            padding: 7px; 
            border-radius: 2px;
            background-color: #7a7a7a96;
            color: white;
        }
        label {
            cursor: pointer;
            margin-left: 9px;
        }
        #viewmode-container{
            border: 2px solid #7a7a7a96;
            border-radius: 4px;
            padding-top: 9px;
            padding-bottom: 9px;
            padding-left: 2px;
            padding-right: 2px;
        }
        #dataToView-container{
            margin-left: 10px;
            margin-right: 10px;
            border: 2px solid #7a7a7a96;
            border-radius: 4px;
            padding-top: 9px;
            padding-bottom: 9px;
            padding-left: 2px;
            padding-right: 2px;
        }
        
    
        #dataContainer:not(:empty) {
            margin: 10px 10px;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1e1e1e;
            color: #e0e0e0;
            min-height: 0px;
            overflow: auto;
            max-height: 112vh;
        }
    
        @media (max-width: 600px) {
    
            input[type="text"],
            input[name="client"],
            button {
                width: calc(100% - 40px);
                margin: 10px 20px;
            }
    
            #dataContainer {
                padding: 10px;
            }
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
    
        table,
        th,
        td {
            border: 1px solid #858585;
        }
    
        th,
        td {
            padding: 8px;
            text-align: left;
        }
    
        td {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
        }    
        th {
            background-color: #f4f4f431;
        }
    
        a {
            color: #7c7c7c;
            font-style: italic;
            text-decoration: underline;
        }
    
        .modal {
            margin: 0px;    
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: scroll;
            background-color: rgba(0, 0, 0, 0.4);
    
        }
    
        .modal-content {
    
            background-color: #1e1e1e;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #858585;
            overflow: scroll;
            max-width: min-content;
            border-radius: 4px;

        }
    
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
    
        .close:hover,
        .close:focus {
            color: rgb(75, 75, 75);
            text-decoration: none;
            cursor: pointer;
        }
    
        .material-symbols-outlined {
            margin: 0 0 0 0;
            padding: 2px;
        } 
        #theme-toggler {
            display: flex;
            float: right;
            margin-top: 10px;
            border: 2px solid #7a7a7a96;
            border-radius: 4px;
            padding: 2px 3px 2px 2px;
            align-items: center;
            justify-content: space-around;
            width: 55px;

        }
        input[name="theme"]{
            position: absolute;
            appearance: none;
        }
        input[name="theme"]:checked + label {
            border-radius: 2px;
            background-color: #7a7a7a96;
            padding: 2px 2px 2px 2px;
            color: white;
        }
        #headerContainer {
            padding: 10px;
        }

    
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
    
    
        ::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
    
        ::-webkit-scrollbar-track {
            background-color: none;
        }
    
        ::-webkit-scrollbar-corner {
            background-color: none;
        }
    
        ::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }

        input::-webkit-calendar-picker-indicator {
            display: none !important;
        }

        input::-webkit-inner-spin-button {
            display: none !important;
        }

    </style>
</head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<body id = "body">
    <div id="headerContainer">
        <input type="text" id="docId" placeholder="Enter docId">
        <span class="input-wrapper">
        <input list="client-list" id="clients" name="client" placeholder="Enter or select client">
        <datalist name="list" id="client-list">
           <option value="auto find">auto find</option>        <option value="accGen/385386">accGen/385386</option>        <option value="acmic/176516">acmic/176516</option>        <option value="acmic/721722">acmic/721722</option>        <option value="alinsco/176695">alinsco/176695</option>        <option value="allUnited/176438">allUnited/176438</option>        <option value="amerCom/423424">amerCom/423424</option>        <option value="amerCom/423437">amerCom/423437</option>        <option value="amerCom/423438">amerCom/423438</option>        <option value="amerCom/423474">amerCom/423474</option>        <option value="amFam/176402">amFam/176402</option>        <option value="amica/719720">amica/719720</option>        <option value="amWins/528529">amWins/528529</option>        <option value="assAmer/717718">assAmer/717718</option>        <option value="assRisk/507508">assRisk/507508</option>        <option value="atlasFin/176458">atlasFin/176458</option>        <option value="atlasFin/511512">atlasFin/511512</option>        <option value="autoClubEnt/176596">autoClubEnt/176596</option>        <option value="autoClubGrp/176433">autoClubGrp/176433</option>        <option value="autoone/289299">autoone/289299</option>        <option value="berkMed/509510">berkMed/509510</option>        <option value="bluefire/176507">bluefire/176507</option>        <option value="canal/502503">canal/502503</option>        <option value="cendant/319504">cendant/319504</option>        <option value="cig/176709">cig/176709</option>        <option value="columbia/176461">columbia/176461</option>        <option value="commIns/176400">commIns/176400</option>        <option value="commIns/408409">commIns/408409</option>        <option value="commWest/449455">commWest/449455</option>        <option value="contentQa/167339">contentQa/167339</option>        <option value="csaa/176620">csaa/176620</option>        <option value="csaa/565566">csaa/565566</option>        <option value="demo/524525">demo/524525</option>        <option value="democompany-pcg/167274">democompany-pcg/167274</option>        <option value="divAuto/176177">divAuto/176177</option>        <option value="encova/176455">encova/176455</option>        <option value="esis/335336">esis/335336</option>        <option value="esis/335339">esis/335339</option>        <option value="esis/335342">esis/335342</option>        <option value="farmersIns/176493">farmersIns/176493</option>        <option value="farmersrulestest/167282">farmersrulestest/167282</option>        <option value="fbfs/519520">fbfs/519520</option>        <option value="fbfspc/176730">fbfspc/176730</option>        <option value="fredLoya/176496">fredLoya/176496</option>        <option value="fredLoya/530531">fredLoya/530531</option>        <option value="fws/176725">fws/176725</option>        <option value="geico/12">geico/12</option>        <option value="geico/13">geico/13</option>        <option value="geico/14">geico/14</option>        <option value="geico/176453">geico/176453</option>        <option value="gmac/4344">gmac/4344</option>        <option value="greatamerican/3435">greatamerican/3435</option>        <option value="greatWestCasualty/176520">greatWestCasualty/176520</option>        <option value="greenStreet/585586">greenStreet/585586</option>        <option value="hanover/176431">hanover/176431</option>        <option value="harleysville/167239">harleysville/167239</option>        <option value="hartforddpr/141142">hartforddpr/141142</option>        <option value="horMann/176553">horMann/176553</option>        <option value="horMann/521522">horMann/521522</option>        <option value="idahofarmbureau/394395">idahofarmbureau/394395</option>        <option value="IESTEST3/167249">IESTEST3/167249</option>        <option value="indianafarmbureaust/167297">indianafarmbureaust/167297</option>        <option value="infinity/176384">infinity/176384</option>        <option value="infinity/498499">infinity/498499</option>        <option value="kemper/176184">kemper/176184</option>        <option value="kemper/498499">kemper/498499</option>        <option value="kemper/498569">kemper/498569</option>        <option value="kentuckyNat/176449">kentuckyNat/176449</option>        <option value="kentuckyNat/513514">kentuckyNat/513514</option>        <option value="LegacyEng/167299">LegacyEng/167299</option>        <option value="libertyMutPers/176338">libertyMutPers/176338</option>        <option value="libertyMutual/176746">libertyMutual/176746</option>        <option value="libertyMutualPilot/176519">libertyMutualPilot/176519</option>        <option value="mapfre/176314">mapfre/176314</option>        <option value="mapfre/176604">mapfre/176604</option>        <option value="mapfre/176604">mapfre/176604</option>        <option value="mapfre/420421">mapfre/420421</option>        <option value="mapfre/443444">mapfre/443444</option>        <option value="maxumSpec/176664">maxumSpec/176664</option>        <option value="meemic/176678">meemic/176678</option>        <option value="mendota/176728">mendota/176728</option>        <option value="metlife/176462">metlife/176462</option>        <option value="mobilitas/176714">mobilitas/176714</option>        <option value="mobilitas/536537">mobilitas/536537</option>        <option value="mutOfEnumclaw/176420">mutOfEnumclaw/176420</option>        <option value="mutOfEnumclaw/500501">mutOfEnumclaw/500501</option>        <option value="nationwide/176370">nationwide/176370</option>        <option value="nationwide/176506">nationwide/176506</option>        <option value="nationwide/180181">nationwide/180181</option>        <option value="nationwide/180182">nationwide/180182</option>        <option value="nationwide/180183">nationwide/180183</option>        <option value="nationwide/180184">nationwide/180184</option>        <option value="navMgmt/176691">navMgmt/176691</option>        <option value="ncfb/176542">ncfb/176542</option>        <option value="NewRulesEng/167298">NewRulesEng/167298</option>        <option value="nfu/1718">nfu/1718</option>        <option value="noblr/176514">noblr/176514</option>        <option value="noblr/928929">noblr/928929</option>        <option value="ohioMut/176222">ohioMut/176222</option>        <option value="preferredMutual/176735">preferredMutual/176735</option>        <option value="preferredMutual/579580">preferredMutual/579580</option>        <option value="pronto/176682">pronto/176682</option>        <option value="QAIES3/167300">QAIES3/167300</option>        <option value="quincy/176727">quincy/176727</option>        <option value="RapidBillReview/567568">RapidBillReview/567568</option>        <option value="root/176680">root/176680</option>        <option value="root/572573">root/572573</option>        <option value="rulesenginetest/167281">rulesenginetest/167281</option>        <option value="safeco/6768">safeco/6768</option>        <option value="safeco/6769">safeco/6769</option>        <option value="safeco/6770">safeco/6770</option>        <option value="safeco/6771">safeco/6771</option>        <option value="safeco/6772">safeco/6772</option>        <option value="safeco/6773">safeco/6773</option>        <option value="safeco/6775">safeco/6775</option>        <option value="safeco/6776">safeco/6776</option>        <option value="sandbox/964965">sandbox/964965</option>        <option value="sbi/176723">sbi/176723</option>        <option value="scottsdale/176345">scottsdale/176345</option>        <option value="scottsdale/450451">scottsdale/450451</option>        <option value="scottsdale/450497">scottsdale/450497</option>        <option value="sedgwick/352471">sedgwick/352471</option>        <option value="sentry/61359">sentry/61359</option>        <option value="shelter/176463">shelter/176463</option>        <option value="shelter/526527">shelter/526527</option>        <option value="shelter/526607">shelter/526607</option>        <option value="southernGeneral/176749">southernGeneral/176749</option>        <option value="stateAuto/176459">stateAuto/176459</option>        <option value="stateAuto/534535">stateAuto/534535</option>        <option value="TestClient/123456">TestClient/123456</option>        <option value="theHartford/176189">theHartford/176189</option>        <option value="tnfb/176309">tnfb/176309</option>        <option value="tnfb/176668">tnfb/176668</option>        <option value="toggle/176742">toggle/176742</option>        <option value="togglest-qa/167296">togglest-qa/167296</option>        <option value="tower/401402">tower/401402</option>        <option value="travelers/154217">travelers/154217</option>        <option value="travelers/176559">travelers/176559</option>        <option value="travelersrulestest/167283">travelersrulestest/167283</option>        <option value="universalunderwriters/404405">universalunderwriters/404405</option>        <option value="uploadsection/167210">uploadsection/167210</option>        <option value="usaa/133136">usaa/133136</option>        <option value="usaa/175176">usaa/175176</option>        <option value="usaa/175177">usaa/175177</option>        <option value="usaa/176308">usaa/176308</option>        <option value="usaa/176308">usaa/176308</option>        <option value="uticaAuto/176732">uticaAuto/176732</option>        <option value="uticaGeneral/176731">uticaGeneral/176731</option>        <option value="vermontmutual/427428">vermontmutual/427428</option>        <option value="wdbTest/293294">wdbTest/293294</option>        <option value="wdbTest/293294">wdbTest/293294</option>        <option value="wdbTest/293456">wdbTest/293456</option>        <option value="windhaven/505506">windhaven/505506</option>        <option value="zurichamerican/237238">zurichamerican/237238</option>
        </datalist>
        </span>
        <input type="text" id="tokenInput" placeholder="Enter Auth Token">
        <button
            onclick="(async function(){ const result = await fetchJSON(); if (result) await format(); else alert('Failed to fetch ' + document.querySelector('input[name=\'dataToView\']:checked').value); })();">Fetch</button>
        <span id="viewmode-container">
            <input id="jsonView" type="radio" name="viewMode" group="data" value="text" onclick="format()" checked>
            <label for="jsonView">JSON</label>
            <input id="tableView" type="radio" name="viewMode" group="data" onclick="format()" value="table">
            <label for="tableView">Table</label>
        </span>
    
        <span id="dataToView-container">
            <input id="responseRadio" type="radio" name="dataToView" group="data" onclick="format()" value="Response" checked>
            <label for="responseRadio">Response</label>
            <input id="requestRadio" type="radio" name="dataToView" group="data" onclick="format()" value="Request">
            <label for="requestRadio">Request</label>
            <input id="bundlerRadio" type="radio" name="dataToView" group="data" onclick="format()" value="Bundler">
            <label for="bundlerRadio">Bundler</label>
        </span>

        <button id="printExcel" onclick="printExcel()">Export to xl</button>
        <button id="combine-data" onclick="integrateData()">Integrate</button>

        <span id="theme-toggler">
            <input id="darkRadio" type="radio" name="theme" onclick="switchTheme()" value="dark" checked>
            <label for="darkRadio" class="material-symbols-outlined">dark_mode</label>
            <input id="lightRadio" type="radio" name="theme" onclick="switchTheme()" value="light">
            <label for="lightRadio" class="material-symbols-outlined">light_mode</label>
        </span>        
    </div>
    <pre id="dataContainer"></pre>
<script defer>
    var jsonData = null;
    var id = 0;
    const dataContainer = document.getElementById('dataContainer');
    var responseMap = new Map();
    var viewMode = document.querySelector('input[name="viewMode"]:checked').value;
    var dataToView = document.querySelector('input[name="dataToView"]:checked').value;
    var globalTable = null;

   async function fetchJSON() {
        dataContainer.innerHTML = '';
        responseMap.clear();
        const doc = document.getElementById('docId').value;
        var client = document.getElementById('clients').value;
        const token = document.getElementById('tokenInput').value;

        if (!doc) {
            alert("Enter a DocId");
            throw new Error('doc is null');
        }
        (client == 'auto find') ? client = await findClient(doc, token) : null;
        if (client == '' || !(/^[a-zA-Z]+\/\d+$/.test(client)) || client == null) {
            alert("Select a Valid Client");
            throw new Error('client is null');
        }
        if(!token){
            alert("Enter Auth Token");
            throw new Error('token is null');
        }

        const responseUri = "https://rbr-qa.nonprod.aws.casualty.cccis.com/service-gateway/api/requests/" + client + "/" + doc
                + "/withRecs";
        const requestUri = "https://rbr-qa.nonprod.aws.casualty.cccis.com/service-gateway/api/requests/" + client + "/" + doc
                            + "/" +
                            "?inflateBills=true" +
                            "&inflateHistoryBills=true" +
                            "&inflateHistoryRecommendations=true" +
                            "&includeAllRequests=true";
        const bundlerUri = "https://rbr-qa.nonprod.aws.casualty.cccis.com/service-gateway/api/recommendations/" + client + "?docId=" + doc
                            + "&category=bundlerRecommendation";
        
        const uriMap = {
            'Response': responseUri,
            'Request': requestUri,
            'Bundler': bundlerUri
        };
        for (const uri in uriMap) {
                await fetch(uriMap[uri], {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                }).then(response => response.json())
                .then(data => {
                    responseMap.set(uri, data);
                }).catch(error => {
                    responseMap.set(uri, 'Error: ' + error.message);
                });
        }
        return !(typeof responseMap.get(dataToView) === 'string');
    }

    async function findClient(doc, token) {
        const allClients = ["nationwide/180181", "nationwide/180182", "nationwide/180183", "nationwide/180184", "kentuckyNat/176449", "kentuckyNat/513514", "kemper/498499", "kemper/498569", "geico/12", "geico/13", "geico/14", "horMann/521522", "mapfre/420421", "mapfre/443444", "mutOfEnumclaw/500501", "safeco/6768", "safeco/6769", "safeco/6770", "safeco/6771", "safeco/6772", "safeco/6773", "safeco/6775", "safeco/6776", "noblr/928929", "csaa/565566", "root/572573", "stateAuto/534535", "infinity/498499", "usaa/175176", "usaa/175177", "nationwide/176370", "nationwide/176506", "farmersIns/176493", "geico/176453", "libertyMutPers/176338", "mobilitas/536537", "ncfb/176542", "wdbTest/293294", "travelers/154217", "travelers/176559", "wdbTest/293456", "commIns/176400", "commIns/408409", "commWest/449455", "contentQa/167339", "libertyMutual/176746", "RapidBillReview/567568", "libertyMutualPilot/176519", "southernGeneral/176749", "horMann/176553", "stateAuto/176459", "toggle/176742", "mapfre/176604", "bluefire/176507", "amerCom/423424", "amerCom/423437", "amerCom/423438", "amerCom/423474", "kemper/176184", "mapfre/176314", "mapfre/176604", "infinity/176384", "fws/176725", "usaa/133136", "sbi/176723", "usaa/176308", "preferredMutual/176735", "root/176680", "mutOfEnumclaw/176420", "travelersrulestest/167283", "farmersrulestest/167282", "csaa/176620", "mobilitas/176714", "noblr/176514", "accGen/385386", "acmic/176516", "acmic/721722", "alinsco/176695", "allUnited/176438", "amFam/176402", "amica/719720", "amWins/528529", "assAmer/717718", "assRisk/507508", "atlasFin/176458", "atlasFin/511512", "autoClubEnt/176596", "autoClubGrp/176433", "autoone/289299", "berkMed/509510", "canal/502503", "cendant/319504", "cig/176709", "columbia/176461", "demo/524525", "democompany-pcg/167274", "divAuto/176177", "encova/176455", "esis/335336", "esis/335339", "esis/335342", "fbfs/519520", "fbfspc/176730", "fredLoya/176496", "fredLoya/530531", "gmac/4344", "greatamerican/3435", "greatWestCasualty/176520", "greenStreet/585586", "hanover/176431", "harleysville/167239", "hartforddpr/141142", "idahofarmbureau/394395", "IESTEST3/167249", "indianafarmbureaust/167297", "LegacyEng/167299", "maxumSpec/176664", "meemic/176678", "mendota/176728", "metlife/176462", "navMgmt/176691", "NewRulesEng/167298", "nfu/1718", "ohioMut/176222", "pronto/176682", "QAIES3/167300", "quincy/176727", "rulesenginetest/167281", "sandbox/964965", "scottsdale/176345", "scottsdale/450451", "scottsdale/450497", "sedgwick/352471", "sentry/61359", "shelter/176463", "shelter/526527", "shelter/526607", "theHartford/176189", "tnfb/176309", "tnfb/176668", "togglest-qa/167296", "tower/401402", "universalunderwriters/404405", "uploadsection/167210", "uticaAuto/176732", "uticaGeneral/176731", "vermontmutual/427428", "windhaven/505506", "zurichamerican/237238", null];

        for(let client of allClients){
            if(client === null){
                alert("Couldn't find any client");
                throw new Error("Couldn't find any client");
            }
            document.getElementById('clients').value = client;
            const responseUri = "https://rbr-qa.nonprod.aws.casualty.cccis.com/service-gateway/api/requests/" + client + "/" + doc + "/withRecs";
            try{
            const response = await fetch(responseUri, {
                method: 'GET',
                headers: {
                    Authorization: `Bearer ${token}`,
                },
            });

            if (response.ok) {
                const apiResponse = await response.text();
                if (apiResponse.length > 10000) {
                    return client;
                }
            } else {
                continue;
            }
        } catch (error) {
            window.alert(error.message);
            throw new Error(error.message);
            return;
        }
    }
    }

    async function format() {

        viewMode = document.querySelector('input[name="viewMode"]:checked').value;
        dataToView = document.querySelector('input[name="dataToView"]:checked').value;

        if(!responseMap || responseMap.size === 0 || !responseMap.get(dataToView) || (responseMap.get(dataToView) === 'string' && responseMap.get(dataToView).startsWith('Error:'))) {
            window.alert('Failed to get ' + dataToView);
            return;
        }

        dataContainer.innerHTML = '';
        jsonData = responseMap.get(dataToView);
        if (viewMode === 'text') {
            dataContainer.textContent = JSON.stringify(jsonData, null, 2);
            hljs.highlightElement(dataContainer, {language: 'json'});
        } else if (viewMode === 'table') {
            if (jsonData === null || jsonData === '' || typeof jsonData === 'string') 
            {
                window.alert('Invalid JSON data');
            return;
            }
            generateTable(jsonData, "dataContainer");
        }
        switchTheme();
    }

    function generateTable(data, containerId) {
        var table = document.createElement('table');


        var container = document.getElementById(containerId);
        const isArray = Array.isArray(data);

        if(typeof data === 'string'){
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.textContent = data;
            cell.style.maxWidth = '500px';
            cell.style.wordWrap = 'break-word';
            cell.style.overflow = 'show';
            cell.style.whiteSpace = 'normal';
            row.appendChild(cell);
            table.appendChild(row);
            container.appendChild(table);
            return table;
        }

        if (isArray && typeof data[0] !== "string") {

            var headers = new Set();
            data.forEach(rowData => {
                Object.keys(rowData).forEach(header => {
                    headers.add(header);
                });
            });
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            data.forEach(rowData => {
                const row = document.createElement('tr');
                headers.forEach(header => {
                    const cell = document.createElement('td');
                    const value = rowData[header];
                    if (typeof value === "object" && value !== null && value.length !== 0 && typeof value[0] !== 'string' && typeof value[0] !== 'number') {
                        const link = document.createElement("a");
                        link.href = "#";
                        link.textContent = "[...]";
                        link.onclick = function () {
                            openModal(value);
                        };
                        cell.appendChild(link);
                    } else {
                        cell.textContent = value;
                        
                    } 
                    cell.onclick = function () {
                        if(cell.textContent !== '[...]' && cell.textContent !== '[..]'){
                            openModal(value);
                        }
                    };
                    row.appendChild(cell);
                });
                table.appendChild(row);
            });
            container.appendChild(table);

        }
        else {
            for (let key in data) {
                const row = document.createElement("tr");

                const cell1 = document.createElement("td");
                cell1.textContent = key;

                const cell2 = document.createElement("td");
                const value = data[key];

                if (typeof value === "object" && value !== null && value.length !== 0 && typeof value[0] !== 'string' && typeof value[0] !== 'number') {
                    const link = document.createElement("a");
                    link.href = "#";
                    link.textContent = "[..]";
                    link.onclick = function () {
                        openModal(value);
                    };
                    cell2.appendChild(link);
                } else {
                    if(value === null){
                        cell2.textContent = 'null';
                    } else {
                    cell2.textContent = value;
                    }
                } 
                    cell2.onclick = function () {
                        if(cell2.textContent !== '[...]' && cell2.textContent !== '[..]'){
                            openModal(value);
                        }
                    };

                row.appendChild(cell1);
                row.appendChild(cell2);
                table.appendChild(row);
            }

            container.appendChild(table);
        }
        return table;
    }

    function openModal(data) {
        const modal = createModal();
        document.body.appendChild(modal);
        generateTable(data, "nestedTable" + id);
        modal.style.display = "block";
    }

    function createModal() {
        const modal = document.createElement("pre");
        modal.classList.add("modal");

        const modalContent = document.createElement("div");
        modalContent.classList.add("modal-content");

        if(document.getElementById("lightRadio").checked){
            modalContent.style.backgroundColor = "white";
            modalContent.style.color = "black";
        }

        const closeButton = document.createElement("span");
        closeButton.classList.add("close");
        closeButton.innerHTML = "&times;";
        closeButton.onclick = function () {
            modal.style.display = "none";
            document.body.removeChild(modal);
        };

        modalContent.appendChild(closeButton);

        const nestedTable = document.createElement("div");
        nestedTable.id = "nestedTable" + ++id;

        modalContent.appendChild(nestedTable);

        modal.appendChild(modalContent);

        return modal;
    }

    function closeModal() {
        const modal = document.getElementById("modal");
        modal.style.display = "none";
    }


    function printExcel() {
        
        globalTable = document.getElementById('dataContainer').querySelector('table');

        if(!globalTable){
            window.alert('No table to export');
            return;
        }

        const workbook = XLSX.utils.book_new();

        const worksheet = XLSX.utils.table_to_sheet(globalTable);

        XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");

        XLSX.writeFile(workbook, "data.xlsx");

    }
    function createCell(content) {

        const cell = document.createElement('td');
        cell.textContent = content || '';
        cell.onclick = function () {
            if(cell.textContent !== '[...]' && cell.textContent !== '[..]'){
                openModal(content);   
            }
        };
        return cell;
   }

   function createTHead(content) {
        const thead = document.createElement('th');
        thead.textContent = content || '';
        return thead;
    }

    function integrateData() {
        const response = responseMap.get('Response');
        const request = responseMap.get('Request');
        const bundler = responseMap.get('Bundler');

        if (typeof response === 'string' && response.startsWith('Error:')) {
            window.alert('Failed to fetch response');
            return;
        }

        const docInfoMap = {
            'docId': response[0]['docId'] || '', 
            'requestId': response[0]['requestId'] || '', 
            'correlationId': response[0]['correlationId'] || '',
            'clientCode': response[0]['clientCode'] || '', 
            'formType': response[0]['formType'].includes('cms') ? 'CMS-1500' : response[0]['formType'].includes('ub04') ? 'UB-04' : response[0]['formType'].includes('nf3') ? 'NF-3' : 'Non-Standard',
            'treatmentState': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['treatmentState'] || '',
            'treatmentZip': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['treatmentZip'] || '',
            'providerTitle': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['providerTitle'] || '',
            'billType': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['billType'] || '',
            'AdjusterFcc': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['AdjusterFcc'] || '',
            'clientReceivedDate': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['clientReceivedDate'] || '',
            'facilityIndicator': !request['request'] ? '' : String(request['request'][0]['bills'][0]['supportingInformation']['facilityIndicator']) || '',
            'typeOfBill': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['typeOfBill'] || '',
            'fpmEligibilityStatus': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['fpmEligibilityStatus'] || '',
            'RiskState': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['RiskState'] || '',
            'claimHandlingSystem': !request['request']? '' : request['request'][0]['supportingInformation']['claim']['claimHandlingSystem'] || '',
            'dateOfLoss': !request['request']? '' : request['request'][0]['supportingInformation']['claim']['dateOfLoss'] || '',
            'policyCoverageType': !request['request']? '' : request['request'][0]['supportingInformation']['claim']['policyCoverageType'] || '',
            'medExposure': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['medExposure'] || '',
            'documentSource': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['documentSource'] || '',
            'abpStatus': !request['request']? '' : request['request'][0]['bills'][0]['supportingInformation']['abpStatus'] || '',

        };

        const formType = docInfoMap['formType'];

        const docInfoKeyRow = document.createElement('tr');
        const docInfoValueRow = document.createElement('tr');


        for (const docInfo in docInfoMap) {
            docInfoKeyRow.appendChild(createTHead(docInfo));
            docInfoValueRow.appendChild(createCell(docInfoMap[docInfo]));
        }

        const integratedTable = document.createElement('table');

        integratedTable.appendChild(docInfoKeyRow);
        integratedTable.appendChild(docInfoValueRow);

        
        const headers = ['lineNo', 'serviceDate', 'cptHcpcs', 'revenueCode', 'modifier1', 'modifier2', 'modifier3', 'modifier4', 'serviceUnits', 'totalCharges', 'displayLineNo', 'appliedFlag','fireFlagRule', 'firedReimburseRule', 'firedDenyRule', 'firedBundlerRules', 'bundlerRuleName', 'lineReimburse', 'lineRuleName', 'finalRc', 'finalReimburse'];
        
        const headerRow = document.createElement('tr');

        const emptyRow = document.createElement('tr');

        headers.forEach(h => {
        
        headerRow.appendChild(createTHead(h));

        emptyRow.appendChild(createCell(''));

        });

        emptyRow.style.height = '30px';

        integratedTable.appendChild(emptyRow);

        integratedTable.appendChild(headerRow);

        const linesArray = [];
        if(request[['request'][0]])
        request['request'][0]['bills'][0]['pages'].forEach(page => {
            page['lines'].forEach(line => {linesArray.push(line);});
        });

        for (let i in response) {
            const line = linesArray[i];
            const recs = response[i];
            const lineId = recs['lineId'] || '';

            const row = document.createElement('tr');

            row.appendChild(createCell(line ? line['lineNo'] : ''));

            if (formType == 'CMS-1500') {
                row.appendChild(createCell(!line ? '' : line['serviceDateFrom']['month'] + '/' + line['serviceDateFrom']['day'] + '/' + line['serviceDateFrom']['year']));
                row.appendChild(createCell(!line ? '' : line['cptHcpcs']));
                row.appendChild(createCell((formType == "Non-Standard" || formType == "UB-04") ? line['revenueCode'] : ''));
                row.appendChild(createCell(!line ? '' : line['modifier1']));
                row.appendChild(createCell(!line ? '' : line['modifier2']));
                row.appendChild(createCell(!line ? '' : line['modifier3']));
                row.appendChild(createCell(!line ? '' : line['modifier4']));
                row.appendChild(createCell(!line ? '' : line['daysOrUnits']));
                row.appendChild(createCell(!line ? '' : line['charges']));
            } else if (formType == 'UB-04') {
                row.appendChild(createCell(!line ? '' : line['inferredValues'][0]['value']));
                row.appendChild(createCell(!line ? '' : line['inferredValues'][2]['value']));
                row.appendChild(createCell((formType == "Non-Standard" || formType == "UB-04") ? line['revenueCode'] : ''));
                row.appendChild(createCell(!line ? '' : line['inferredValues'][3]['values'][0]));
                row.appendChild(createCell(!line ? '' : line['inferredValues'][3]['values'][1]));
                row.appendChild(createCell(!line ? '' : line['inferredValues'][3]['values'][2]));
                row.appendChild(createCell(!line ? '' : line['inferredValues'][3]['values'][3]));
                row.appendChild(createCell(!line ? '' : line['serviceUnits']));
                row.appendChild(createCell(!line ? '' : line['totalCharges']));
            } else {
                row.appendChild(createCell(!line ? '' : line['serviceDate']['month'] + '/' + line['serviceDate']['day'] + '/' + line['serviceDate']['year']));
                row.appendChild(createCell(!line ? '' : line['cptHcpcs']));
                row.appendChild(createCell((formType == "Non-Standard" || formType == "UB-04") ? line['revenueCode'] : ''));
                row.appendChild(createCell(!line ? '' : line['modifiers'][0]));
                row.appendChild(createCell(!line ? '' : line['modifiers'][1]));
                row.appendChild(createCell(!line ? '' : line['modifiers'][2]));
                row.appendChild(createCell(!line ? '' : line['modifiers'][3]));
                row.appendChild(createCell(!line ? '' : line['daysOrUnits']));
                row.appendChild(createCell(!line ? '' : line['charges']));
            }

            row.appendChild(createCell(recs['displayLineNo']));
            row.appendChild(createCell(recs['appliedFlag']));
            row.appendChild(createCell(recs['fireFlagRule']));
            row.appendChild(createCell(recs['firedReimburseRule']));
            row.appendChild(createCell(recs['firedDenyRule']));
            if(bundler['recommendationSets'])
            var firedBundlerRules = (bundler['recommendationSets'][0]['recommendations'] || []).filter(recommendation => recommendation['targetReference'].includes('lines[@.metadata.id==\''+lineId)).map(recommendation => recommendation['rule']['name']);
            row.appendChild(createCell(firedBundlerRules || ''));
            row.appendChild(createCell(recs['bundlerRuleName']));
            row.appendChild(createCell(recs['lineReimburse']));
            row.appendChild(createCell(recs['lineRuleName']));
            row.appendChild(createCell(recs['finalRc']));
            row.appendChild(createCell(recs['finalReimburse']));

            integratedTable.appendChild(row);
        }

        dataContainer.innerHTML = '';

        dataContainer.appendChild(integratedTable);
    }

    async function switchTheme() {
            const checkbox = document.getElementById("lightRadio");
                if (checkbox.checked) {
                    document.getElementById("body").style.backgroundColor = "white";
                    document.querySelectorAll('label').forEach(function (element) { element.style.color = "black"; });
                    document.querySelectorAll('input[type="text"], input[name="client"]').forEach(function (element) { element.style.color = "black"; });
                    document.querySelectorAll('input[type="text"], input[name="client"]').forEach(function (element) { element.style.backgroundColor = "white"; });
                    document.getElementById("dataContainer").style.color = "black";
                    document.getElementById("dataContainer").style.backgroundColor = "white";
                    document.querySelectorAll('.hljs-attr').forEach(function (element) { element.style.color = "#3240ff"; });
                    document.querySelectorAll('.hljs-string').forEach(function (element) { element.style.color = "#ff0000"; });
                    document.querySelectorAll('.hljs-number').forEach(function (element) { element.style.color = "#16b887"; });
                    document.querySelectorAll('.hljs-keyword').forEach(function (element) { element.style.color = "grey"; });
                    document.querySelectorAll('.hljs-punctuation').forEach(function (element) { element.style.color = "#7c7c7c"; });
                }
                else {
                    document.getElementById("body").style.backgroundColor = "black";
                    document.getElementById("dataContainer").style.backgroundColor = "#1e1e1e";
                    document.getElementById("dataContainer").style.color = "white";
                    document.querySelectorAll('label').forEach(function (element) { element.style.color = "white"; });
                    document.querySelectorAll('input[type="text"], input[name="client"]').forEach(function (element) { element.style.color = "white"; });
                    document.querySelectorAll('input[type="text"], input[name="client"]').forEach(function (element) { element.style.backgroundColor = "#1e1e1e"; });
                    document.querySelectorAll('.hljs-attr').forEach(function (element) { element.style.color = "#51b7ee"; });
                    document.querySelectorAll('.hljs-string').forEach(function (element) { element.style.color = "#CE9178"; });
                    document.querySelectorAll('.hljs-number').forEach(function (element) { element.style.color = "#16b887"; });
                    document.querySelectorAll('.hljs-keyword').forEach(function (element) { element.style.color = "#3273ff"; });
                    document.querySelectorAll('.hljs-punctuation').forEach(function (element) { element.style.color = "#7c7c7c"; });
                }
        }

</script>
</body>

</html>
